services:
  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    ports:
      - "8191:8191"
    environment:
      - LOG_LEVEL=info
    restart: unless-stopped

  app:
    build:
      context: .
      args:
        - RUN_TESTS=false
    container_name: website-searcher-app
    environment:
      - CF_URL=http://flaresolverr:8191/v1
    depends_on:
      - flaresolverr
    stdin_open: true
    tty: true
    # No command override: default CMD ["websearcher"] keeps it interactive

  tests:
    image: rust:1.89
    container_name: website-searcher-tests
    working_dir: /workspace
    volumes:
      - ./:/workspace
    environment:
      - RUST_BACKTRACE=1
    # CF_URL not required for tests (mocked)
    entrypoint: ["bash", "-lc", "cargo test"]
